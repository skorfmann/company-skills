# Mise configuration for Claude Skills repository
# https://mise.jdx.dev/

[tools]
python = "3.12"

[tasks.build]
description = "Build and package the bewirtungsbeleg skill as a zip file"
run = """
#!/bin/bash
set -e

SKILL_NAME="bewirtungsbeleg"
BUILD_DIR="build"
DIST_DIR="dist"
SKILL_DIR="skills/${SKILL_NAME}"

echo "ğŸ”¨ Building ${SKILL_NAME} skill..."

# Clean previous builds
rm -rf "${BUILD_DIR}" "${DIST_DIR}"
mkdir -p "${BUILD_DIR}/${SKILL_NAME}" "${DIST_DIR}"

# Copy skill files (excluding only build artifacts, keeping config and signature)
echo "ğŸ“¦ Copying skill files..."
rsync -av \
  --exclude='.venv' \
  --exclude='__pycache__' \
  --exclude='*.pyc' \
  --exclude='.pytest_cache' \
  --exclude='.claude' \
  "${SKILL_DIR}/" "${BUILD_DIR}/${SKILL_NAME}/"

# Create the zip file
echo "ğŸ“ Creating zip archive..."
cd "${BUILD_DIR}"
zip -r "../${DIST_DIR}/${SKILL_NAME}.zip" "${SKILL_NAME}"
cd ..

# Cleanup
rm -rf "${BUILD_DIR}"

echo "âœ… Build complete: ${DIST_DIR}/${SKILL_NAME}.zip"
ls -lh "${DIST_DIR}/${SKILL_NAME}.zip"
"""

[tasks.build-all]
description = "Build all skills and create distribution packages"
run = """
#!/bin/bash
set -e

echo "ğŸ”¨ Building all skills..."
mise run build

echo "âœ… All builds complete!"
ls -lh dist/
"""

[tasks.clean]
description = "Clean build artifacts and temporary files"
run = """
#!/bin/bash
echo "ğŸ§¹ Cleaning build artifacts..."
rm -rf build/ dist/ *.zip
find . -type d -name '__pycache__' -exec rm -rf {} + 2>/dev/null || true
find . -type d -name '.pytest_cache' -exec rm -rf {} + 2>/dev/null || true
find . -type f -name '*.pyc' -delete
echo "âœ… Clean complete!"
"""

[tasks.install]
description = "Install dependencies for bewirtungsbeleg skill"
run = """
#!/bin/bash
cd skills/bewirtungsbeleg
if command -v uv &> /dev/null; then
    echo "ğŸ“¦ Installing with uv..."
    uv sync
else
    echo "ğŸ“¦ Installing with pip..."
    python -m venv .venv
    source .venv/bin/activate
    pip install -e .
fi
echo "âœ… Dependencies installed!"
"""

[tasks.setup]
description = "Setup the bewirtungsbeleg skill for first-time use"
run = """
#!/bin/bash
set -e

SKILL_DIR="skills/bewirtungsbeleg"

echo "ğŸš€ Setting up bewirtungsbeleg skill..."

# Check if config.yml exists
if [ ! -f "${SKILL_DIR}/config.yml" ]; then
    echo "ğŸ“ Creating config.yml from template..."
    cp "${SKILL_DIR}/config.example.yml" "${SKILL_DIR}/config.yml"
    echo "âš ï¸  Please edit ${SKILL_DIR}/config.yml with your details"
else
    echo "âœ… config.yml already exists"
fi

# Check if signature.png exists
if [ ! -f "${SKILL_DIR}/assets/signature.png" ]; then
    echo "âš ï¸  Please add your signature image to ${SKILL_DIR}/assets/signature.png"
    echo "   See ${SKILL_DIR}/assets/signature.example.png for reference"
else
    echo "âœ… signature.png exists"
fi

# Install dependencies
mise run install

echo "âœ… Setup complete!"
echo ""
echo "Next steps:"
echo "1. Edit ${SKILL_DIR}/config.yml with your details"
echo "2. Add your signature to ${SKILL_DIR}/assets/signature.png"
echo "3. Run 'mise run build' to create a distribution package"
"""
